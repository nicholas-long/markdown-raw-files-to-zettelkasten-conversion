#!/bin/bash
export MY_ID=20221012144502
export RECENT_MOD=20221012171100
export IMPL=20221006032546

export recenttimestamp=$(date --date='1 hours ago' --iso +%Y%m%d%H%M%S)
echo "$recenttimestamp"

#tf=$(mktemp)
#echo "not enabled yet"
#exit 0

# IDs currently attached to node
#echo IDs currently attached to node
#$prog refs $RECENT_MOD | grep -v $MY_ID | awk '
#{
#  command = ENVIRON["prog"] " unlink " ENVIRON["RECENT_MOD"] " " $0
#  system(command)
#}
#'
## cleared out all the old IDs.

find zet -type f -name README.md 2>/dev/null | awk -F / '$(NF - 1) > ENVIRON["recenttimestamp"]'
#| \zet/$IMPL/parseids | grep -v -f <( cat << EOF
#$MY_ID
#EOF
#)  | awk '
#{
#  id = $0
#  command = "git log --date=unix -- zet/" id "/README.md"
#  while ((command | getline) > 0) {
#    if ($0 ~ /^Date:/) {
#      print $2, id
#    }
#  }
#  close(command)
#}
#' | sort -n | awk '
#{
#  id = $2
#  command = ENVIRON["prog"] " addref -t " ENVIRON["RECENT_MOD"] " " id
#  system(command)
#}
#'

#rm "$tf"
