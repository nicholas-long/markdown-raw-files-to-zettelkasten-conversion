# active directory domain to try list
- sensitive content in file shares
- anonymous ldap enumeration - nmap scripts
- create username list with different formats to identify usernames
- kerbrute
  - user enum
  - password spray
    - sync time before password spray! `ntpdate`; VM -> stop time sync with host or spray with CME
  - brute force
- crackmapexec
  - usernames as passwords
  - SMB
  - WinRM
  - MSSQL
  - other services exposed
- CYCLE -> reuse credentials, access services, abuse access, get more credentials
  - RDP
  - SMB shares and PsExec ( crackmapexec )
  - WinRM
- https://wadcoms.github.io/#
- adPEAS
- unauthenticated ASREP roast with usernames list
- retry credentials for every service
- discover common temporary password -> spray
- unauthenticated RPC enum ` rpcclient --no-pass -U '' $IP `
- got access to dump data from LDAP
  - grep `sAMAccountName`
  - grep `CN=`
- authenticated ( probably ) lateral movement
  - impacket
    - roasting SPN service accounts
    - ASREP roast no preauth users
    - get AD users - any authenticated user
      - check notes/description of LDAP data for leaked passwords
    - impacket-findDelegation (bloodhound checks this too)
  - ldap enumeration - ldapdomaindump, bloodhound
  - bloodhound
    - run python version bloodhound.py in docker
    - check outbound object control of every owned user
    - shortest paths from owned
    - sharphound all
    - queries on json data
      - users - description, password last set, last login & timestamp
      - computers - OS
  - add dc hostname and machine name to hosts file if this can't authenticate
  - list and impersonate tokens on compromised hosts ( meterpreter incognito )
    - reuse sessions with `New-PSSession` and `Invoke-Command` to other hosts / DC
- shell + switch user `Invoke-RunasCs.ps1`
- shell -> [20221003151207](/zet/20221003151207/README.md) windows privilege escalation
  - PowerView - AD specific powershell enum
    - `Get-netuser` investigate users
- got shell + no creds
  - rubeus
    - kerberoast
    - asreproast
  - run sharphound on target
  - get NTLMv2 hash to crack
- derivitive local admins on workstations / servers
- enumerate sessions with powerview
- enumerate tickets
  - klist
  - other users tickets as admin with mimikatz
- got NTLM hash
  - pass the hash
  - NTLM -> run process as user with mimikatz `sekurlsa::pth` "over pass the hash"
    - `net use \\dchostname`, then get cached kerberos tickets
- target users who might have simple passwords ( bloodhound data, ldap? )
  - users that have not logged in `.lastlogontimestamp == -1`
  - users who had password changed and have not logged in since `.pwdlastset > .lastlogontimestamp`
- check for AD CS `Get-WindowsFeature *ad-certificate*, *adcs*`
  - AD CS -> 7 scenarios of misconfigured certificate templates and access
  - 2022 relay DC attack CVE-2022-26925 variation of petitpotam
- common exploits
  - headline exploits
    - 2021 - nopac attack `sam the admin` on github, then psexec
    - 2020 - zerologon
  - ticket attacks
    - silver ticket to domain admin CVE-2014-6324
- have local admin and office installed and remote ports 135,445 -> DCOM lateral movement excel remote macro
- relay NTLMv2 hashes to other machines that have no SMB signing
- endgame dump hashes
  - impacket secretsdump
  - mimikatz on machine or kiwi module in msf

` zet/20221003151172/README.md `

# Related

- [20221003150485](/zet/20221003150485/README.md) active directory get GMSA service account properties get GMSA password and run commands
- [20221003150477](/zet/20221003150477/README.md) general enumeration Active Directory Certificate Services is AD CS enabled
- [20221019150132](/zet/20221019150132/README.md) kerberos AD commands
- [20221003150752](/zet/20221003150752/README.md) kerbrute enumerate users using wordlist
- [20221003150751](/zet/20221003150751/README.md) kerbrute password spray users from user list file
- [20221017172946](/zet/20221017172946/README.md) LAN attacks
- [20221003150464](/zet/20221003150464/README.md) powershell load PSCredential password import from file
- [20221014185629](/zet/20221014185629/README.md) kb file named kb/hacking/to-try-lists/active-directory-domain.md
- [20221003151175](/zet/20221003151175/README.md) EVERYTHING - common to try list
- [20221003150488](/zet/20221003150488/README.md) active directory
- [20221003150425](/zet/20221003150425/README.md) kerberos attack on windows host
- [20221003151207](/zet/20221003151207/README.md) windows privilege escalation
- [20221003150628](/zet/20221003150628/README.md) LDAP enumeration anonymous nmap scripts
- [20221003151198](/zet/20221003151198/README.md) SMB to try list
- [20221011181920](/zet/20221011181920/README.md) working notes - foothold
- [20221003151206](/zet/20221003151206/README.md) windows privilege escalation headline exploits
- [20221003150473](/zet/20221003150473/README.md) powershell tricks run powershell commands as another user with RunasCs
- [20221003150967](/zet/20221003150967/README.md) things to check in bloodhound
- [20221013192245](/zet/20221013192245/README.md) cracking hashes
- [20221013190422](/zet/20221013190422/README.md) headline exploits
- [20221003150352](/zet/20221003150352/README.md) fake set change system time for command
- [20221013174958](/zet/20221013174958/README.md) concept of persistence on a target
- [20221003150357](/zet/20221003150357/README.md) create malicious ODT file payload to leak NTLMv2 hashes with badodf
- [20221003151053](/zet/20221003151053/README.md) lsass process contains credentials
- [20221003151030](/zet/20221003151030/README.md) eternalblue MS17-010 - working
- [20221003151218](/zet/20221003151218/README.md) send email over SMTP from command line with swaks
- [20221003151203](/zet/20221003151203/README.md) LDAP
- [20221003151201](/zet/20221003151201/README.md) RDP
- [20221009192000](/zet/20221009192000/README.md) stuff to put on main page
- [20221009102436](/zet/20221009102436/README.md) hacking to try lists
- [20221009005402](/zet/20221009005402/README.md) preparing for the OSCP exam
- [20221008215530](/zet/20221008215530/README.md) username
- [20221007220451](/zet/20221007220451/README.md) hacking notes hub
- [20221006214729](/zet/20221006214729/README.md) alh4zr3d
- [20221003151171](/zet/20221003151171/README.md) active directory domain powershell web access
- [20221003151170](/zet/20221003151170/README.md) active directory domain old
- ~/kb/hacking/to-try-lists/active-directory-domain.md

Tags:

    #to-try-list #hacking #active 
